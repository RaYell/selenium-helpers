<?xml version="1.0" ?>
<project name="Selenium.WebDriver.Extensions" default="full" xmlns="http://nant.sf.net/schemas/nant.xsd">
	<property name="project.framework" value="net-4.5"/>
	<property name="project.config" value="debug"/>
	<property name="project.visual.studio.version" value="12.0"/>
	<property name="path.nunit" value="packages\NUnit.Runners.2.6.3\tools\nunit-console.exe"/>
	<property name="path.opencover" value="packages\OpenCover.4.5.3207\OpenCover.Console.exe"/>
	<property name="path.report.generator" value="packages\ReportGenerator.1.9.1.0\ReportGenerator.exe"/>
	<property name="dir.build" value="../Build"/>
	<property name="dir.work" value="${dir.build}/${project::get-name()}-${project.framework}.${platform::get-name()}-${project.config}"/>
	<property name="dir.unit.tests.jquery" value="test\Selenium.WebDriver.Extensions.JQuery.Tests\bin\${project.config}"/>
    <property name="dir.unit.tests.sizzle" value="test\Selenium.WebDriver.Extensions.Sizzle.Tests\bin\${project.config}"/>
    <property name="dir.unit.tests.queryselector" value="test\Selenium.WebDriver.Extensions.QuerySelector.Tests\bin\${project.config}"/>
    <property name="dir.unit.tests.combined" value="test\Selenium.WebDriver.Extensions.Tests\bin\${project.config}"/>
	<property name="dir.coverage.report" value="${dir.work}\CoverageReport"/>
	<property name="file.unit.tests.jquery" value="${dir.work}\Selenium.WebDriver.Extensions.JQuery.Tests.dll"/>
    <property name="file.unit.tests.sizzle" value="${dir.work}\Selenium.WebDriver.Extensions.Sizzle.Tests.dll"/>
    <property name="file.unit.tests.queryselector" value="${dir.work}\Selenium.WebDriver.Extensions.QuerySelector.Tests.dll"/>
    <property name="file.unit.tests.combined" value="${dir.work}\Selenium.WebDriver.Extensions.Tests.dll"/>
	<property name="file.test.results" value="Selenium.WebDriver.Extensions.Tests.xml"/>
	<property name="file.coverage.report" value="${dir.work}\coverage.xml"/>
	
	<loadtasks assembly="packages\NAnt.Contrib.Portable.0.92\tools\NAnt.Contrib.Tasks.dll" />
		
	<target name="compile">
		<msbuild project="Selenium.WebDriver.Extensions.sln">
			<property name="Configuration" value="${project.config}"/>
			<property name="VisualStudioVersion" value="${project.visual.studio.version}"/>
		</msbuild>
	</target>
	
	<target name="setup.build.process">
		<delete dir="${dir.build}" failonerror="false"/>
		<mkdir dir="${dir.build}"/>
	</target>
	
	<target name="move.assemblies.for.unit.tests">
		<copy todir="${dir.work}" flatten="true">
			<fileset basedir="${dir.unit.tests.jquery}">
				<include name="*.dll"/>
                <include name="*.pdb"/>
			</fileset>
        </copy>
        <copy todir="${dir.work}" flatten="true">
            <fileset basedir="${dir.unit.tests.sizzle}">
				<include name="*.dll"/>
                <include name="*.pdb"/>
			</fileset>
        </copy>
        <copy todir="${dir.work}" flatten="true">
            <fileset basedir="${dir.unit.tests.queryselector}">
				<include name="*.dll"/>
                <include name="*.pdb"/>
			</fileset>
        </copy>
        <copy todir="${dir.work}" flatten="true">
            <fileset basedir="${dir.unit.tests.combined}">
				<include name="*.dll"/>
                <include name="*.pdb"/>
			</fileset>
		</copy>
	</target>
	
	<target name="test" depends="setup.build.process, move.assemblies.for.unit.tests">
		<exec program="${path.nunit}">
			<arg value="${file.unit.tests.jquery} ${file.unit.tests.sizzle} ${file.unit.tests.queryselector} ${file.unit.tests.combined}"/>
			<arg value="/framework:${project.framework}"/>
			<arg value="/work:${dir.work}"/>
			<arg value="/result:${file.test.results}"/>
			<arg value="/nologo"/>
		</exec>
	</target>
	
	<target name="analyse.code.coverage" depends="setup.build.process, move.assemblies.for.unit.tests">
		<exec program="${path.opencover}">
			<arg value="-register:user"/>
			<arg value="-target:&quot;${path.nunit}&quot;"/>
			<arg value="-targetargs:&quot;/noshadow ${file.unit.tests.jquery} ${file.unit.tests.sizzle} ${file.unit.tests.queryselector} ${file.unit.tests.combined} /framework:${project.framework} /work:${dir.work} /result:${file.test.results} /nologo&quot;"/>
			<arg value="-filter:&quot;+[*]* -[*]*Exception* -[*.Tests]*&quot;"/>
            <arg value="-output:&quot;${file.coverage.report}&quot;"/>
		</exec>
	</target>
	
	<target name="coverage" depends="analyse.code.coverage">
		<exec program="${path.report.generator}">
			<arg value="-reports:&quot;${file.coverage.report}&quot;"/>
			<arg value="-targetdir:&quot;${dir.coverage.report}&quot;"/>
			<arg value="-reporttypes:Html"/>
		</exec>
	</target>
	
	<target name="docs">
		<msbuild project="docs/Selenium.WebDriver.Extensions.shfbproj">
			<property name="Configuration" value="${project.config}"/>
			<property name="VisualStudioVersion" value="${project.visual.studio.version}"/>
		</msbuild>
	</target>
	
	<target name="full" depends="compile, test, coverage, docs"/>
</project>